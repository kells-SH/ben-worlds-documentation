<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta property="og:image" content="images/MHCP_OG_image.jpg"/>
  <meta property="og:image:type" content="image/jpeg" />
  <meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="630" />
  <title>MHCP Creator Made Docs</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <!-- Add GitHub Markdown CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/5.2.0/github-markdown-light.min.css">
  <link rel="stylesheet" href="/assets/css/styles.css?v=4633a66e9b4499c8614a483d910c8b4277e9467a">
  <style>
    /* Dark mode fixes for markdown content */
    [data-theme="dark"] .markdown-body {
      color: #e6edf3;
      background-color: transparent;
    }
    
    [data-theme="dark"] .markdown-body h1,
    [data-theme="dark"] .markdown-body h2,
    [data-theme="dark"] .markdown-body h3,
    [data-theme="dark"] .markdown-body h4,
    [data-theme="dark"] .markdown-body h5,
    [data-theme="dark"] .markdown-body h6 {
      color: #e6edf3;
    }
    
    [data-theme="dark"] .markdown-body table {
      background-color: transparent;
      border-collapse: collapse;
      color: #e6edf3;
    }
    
    [data-theme="dark"] .markdown-body table th,
    [data-theme="dark"] .markdown-body table td {
      background-color: #0d1117 !important;
      border: 1px solid #30363d !important;
      color: #e6edf3 !important;
      padding: 6px 13px;
    }
    
    [data-theme="dark"] .markdown-body table th {
      background-color: #21262d !important;
      font-weight: 600;
      color: #f0f6fc !important;
    }
    
    [data-theme="dark"] .markdown-body table tbody tr:nth-child(odd) td {
      background-color: #0d1117 !important;
    }
    
    [data-theme="dark"] .markdown-body table tbody tr:nth-child(even) td {
      background-color: #161b22 !important;
    }
    
    [data-theme="dark"] .markdown-body table tbody tr:hover td {
      background-color: #1c2128 !important;
    }
    
    [data-theme="dark"] .markdown-body pre {
      background-color: #161b22;
      border: 1px solid #30363d;
    }
    
    [data-theme="dark"] .markdown-body code {
      background-color: rgba(110,118,129,0.4);
      color: #e6edf3;
    }
    
    [data-theme="dark"] .markdown-body pre code {
      background-color: transparent;
      color: #e6edf3;
    }
    
    [data-theme="dark"] .markdown-body blockquote {
      border-left: 0.25em solid #30363d;
      color: #8b949e;
    }
    
    [data-theme="dark"] .markdown-body a {
      color: #58a6ff;
    }
    
    [data-theme="dark"] .markdown-body a:hover {
      color: #79c0ff;
    }
    
    /* Enhanced syntax highlighting for dark mode */
    [data-theme="dark"] .markdown-body .highlight pre,
    [data-theme="dark"] .markdown-body pre {
      background-color: #0d1117 !important;
      border: 1px solid #30363d;
    }
    
    [data-theme="dark"] .markdown-body .highlight pre code,
    [data-theme="dark"] .markdown-body pre code {
      background-color: transparent !important;
      color: #e6edf3 !important;
    }
    
    /* GitHub's actual syntax highlighting classes for dark mode */
    [data-theme="dark"] .markdown-body .highlight .kd { color: #ff7b72; } /* Keywords declarations (function, class, etc) - red */
    [data-theme="dark"] .markdown-body .highlight .k { color: #ff7b72; } /* Keywords (if, else, for, etc) - red */
    [data-theme="dark"] .markdown-body .highlight .nx { color: #e6edf3; } /* Names/identifiers - light gray */
    [data-theme="dark"] .markdown-body .highlight .nf { color: #d2a8ff; } /* Function names - purple */
    [data-theme="dark"] .markdown-body .highlight .s1, 
    [data-theme="dark"] .markdown-body .highlight .s2,
    [data-theme="dark"] .markdown-body .highlight .s { color: #a5d6ff; } /* Strings - blue */
    [data-theme="dark"] .markdown-body .highlight .c1,
    [data-theme="dark"] .markdown-body .highlight .c { color: #8b949e; } /* Comments - gray */
    [data-theme="dark"] .markdown-body .highlight .p { color: #e6edf3; } /* Punctuation - light gray */
    [data-theme="dark"] .markdown-body .highlight .mi,
    [data-theme="dark"] .markdown-body .highlight .mf,
    [data-theme="dark"] .markdown-body .highlight .m { color: #79c0ff; } /* Numbers - blue */
    [data-theme="dark"] .markdown-body .highlight .kc { color: #79c0ff; } /* Constants (true, false, null) - blue */
    [data-theme="dark"] .markdown-body .highlight .kt { color: #ff7b72; } /* Type keywords - red */
    [data-theme="dark"] .markdown-body .highlight .na { color: #7ee787; } /* Attributes - green */
    [data-theme="dark"] .markdown-body .highlight .nb { color: #ffa657; } /* Built-ins - orange */
    [data-theme="dark"] .markdown-body .highlight .nc { color: #ffa657; } /* Classes - orange */
    [data-theme="dark"] .markdown-body .highlight .ne { color: #f85149; } /* Exceptions - bright red */
    [data-theme="dark"] .markdown-body .highlight .o { color: #ff7b72; } /* Operators - red */
    [data-theme="dark"] .markdown-body .highlight .ow { color: #ff7b72; } /* Word operators (and, or, not) - red */
    
    /* GitHub's syntax highlighting classes for light mode - GitHub Pages style */
    [data-theme="light"] .markdown-body .highlight .kd { color: #24292e; font-weight: bold; } /* Keywords declarations - bold black */
    [data-theme="light"] .markdown-body .highlight .k { color: #24292e; font-weight: bold; } /* Keywords - bold black */
    [data-theme="light"] .markdown-body .highlight .nx { color: #24292e; } /* Names/identifiers - dark gray */
    [data-theme="light"] .markdown-body .highlight .nf { color: #24292e; } /* Function names - black */
    [data-theme="light"] .markdown-body .highlight .s1, 
    [data-theme="light"] .markdown-body .highlight .s2,
    [data-theme="light"] .markdown-body .highlight .s { color: #032f62; } /* Strings - dark blue */
    [data-theme="light"] .markdown-body .highlight .c1,
    [data-theme="light"] .markdown-body .highlight .c { color: #6a737d; font-style: italic; } /* Comments - gray italic */
    [data-theme="light"] .markdown-body .highlight .p { color: #24292e; } /* Punctuation - dark gray */
    [data-theme="light"] .markdown-body .highlight .mi,
    [data-theme="light"] .markdown-body .highlight .mf,
    [data-theme="light"] .markdown-body .highlight .m { color: #005cc5; } /* Numbers - blue */
    [data-theme="light"] .markdown-body .highlight .kc { color: #24292e; font-weight: bold; } /* Constants - bold black */
    [data-theme="light"] .markdown-body .highlight .kt { color: #24292e; font-weight: bold; } /* Type keywords - bold black */
    [data-theme="light"] .markdown-body .highlight .na { color: #22863a; } /* Attributes - green */
    [data-theme="light"] .markdown-body .highlight .nb { color: #005cc5; } /* Built-ins - blue */
    [data-theme="light"] .markdown-body .highlight .nc { color: #24292e; font-weight: bold; } /* Classes - bold black */
    [data-theme="light"] .markdown-body .highlight .ne { color: #24292e; font-weight: bold; } /* Exceptions - bold black */
    [data-theme="light"] .markdown-body .highlight .o { color: #24292e; } /* Operators - black */
    [data-theme="light"] .markdown-body .highlight .ow { color: #24292e; } /* Word operators - black */
    
    /* Additional syntax highlighting classes for more comprehensive coloring */
    [data-theme="dark"] .markdown-body .pl-kos { color: #ff7b72; } /* Keyword operators */
    [data-theme="dark"] .markdown-body .pl-ent { color: #7ee787; } /* Entity names (green) */
    [data-theme="dark"] .markdown-body .pl-e { color: #ff7b72; } /* Element names (red) */
    [data-theme="dark"] .markdown-body .pl-pse { color: #ff7b72; } /* Pseudo elements (red) */
    [data-theme="dark"] .markdown-body .pl-psf { color: #d2a8ff; } /* Pseudo functions (purple) */
    [data-theme="dark"] .markdown-body .pl-bu { color: #f85149; } /* Built-ins (bright red) */
    [data-theme="dark"] .markdown-body .pl-ii { color: #f85149; } /* Invalid/illegal (bright red) */
    [data-theme="dark"] .markdown-body .pl-corl { color: #a5d6ff; } /* Correlation (blue) */
    [data-theme="dark"] .markdown-body .pl-mb { color: #d2a8ff; } /* Markup bold (purple) */
    [data-theme="dark"] .markdown-body .pl-mi2 { color: #79c0ff; } /* Numbers alternative (blue) */
    [data-theme="dark"] .markdown-body .pl-mdr { color: #d2a8ff; } /* Markup deleted (purple) */
    [data-theme="dark"] .markdown-body .pl-mc { color: #a5d6ff; } /* Markup changed (blue) */
    [data-theme="dark"] .markdown-body .pl-mh { color: #1f6feb; } /* Markup headings (blue) */
    [data-theme="dark"] .markdown-body .pl-ms { color: #7ee787; } /* Markup subheading (green) */
    [data-theme="dark"] .markdown-body .pl-ml { color: #ffdf5d; } /* Markup list (yellow) */
    
    /* TypeScript and JavaScript specific syntax highlighting */
    [data-theme="dark"] .markdown-body .pl-sr { color: #7ee787; } /* String regex (green) */
    [data-theme="dark"] .markdown-body .pl-vpf { color: #d2a8ff; } /* Variable.parameter.function (purple) */
    [data-theme="dark"] .markdown-body .pl-id { color: #ff7b72; } /* Invalid.deprecated (red) */
    [data-theme="dark"] .markdown-body .pl-token.keyword { color: #ff7b72; } /* Token keywords (red) */
    [data-theme="dark"] .markdown-body .pl-token.string { color: #a5d6ff; } /* Token strings (blue) */
    [data-theme="dark"] .markdown-body .pl-token.function { color: #d2a8ff; } /* Token functions (purple) */
    [data-theme="dark"] .markdown-body .pl-token.boolean { color: #79c0ff; } /* Token booleans (blue) */
    [data-theme="dark"] .markdown-body .pl-token.number { color: #79c0ff; } /* Token numbers (blue) */
    [data-theme="dark"] .markdown-body .pl-token.operator { color: #ff7b72; } /* Token operators (red) */
    [data-theme="dark"] .markdown-body .pl-token.punctuation { color: #e6edf3; } /* Token punctuation (white) */
  </style>
</head>
  <!-- Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-D794QVKBJQ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-D794QVKBJQ');
</script>
<body>
  <!-- Header -->
  <header class="site-header">
    <div class="sidebar-backdrop" id="sidebar-backdrop"></div>
      <div class="header-row">
    <div class="left-nav">
    <button class="hamburger" id="menu-toggle">☰</button>
    <div class="logo"><a href="https://mhcpcreators.github.io/worlds-documentation/" id="logo-link">MHCP Creator Made Docs</a></div>
    <div class="mobile-title mobile-only"><a href="https://mhcpcreators.github.io/worlds-documentation/">Creator Docs</a></div>
    <nav class="nav-links">
      <a href="https://mhcpcreators.github.io/worlds-documentation/docs.html#docs%2Fmanuals-and-cheat-sheets%2Fget-started.md">Creator Docs</a>
      <a href="https://developers.meta.com/horizon-worlds/learn">Meta Docs</a>
      <a href="https://github.com/MHCPCreators/horizonCreatorManual">Creator Manual</a>
      <a href="https://communityforums.atmeta.com/t5/Creator-Forum/ct-p/Meta_Horizon_Creator_Forums">Forums</a>
      <a href="https://mhcpcreators.github.io/worlds-documentation/docs.html#docs%2Fmanuals-and-cheat-sheets%2Fcontribute-to-creator-documentation.md">Contribute</a>
    </nav>
    </div>
          <div class="right-controls">
              <a href="https://www.youtube.com/@metahorizoncreatorprogram" target="_blank" style="color: #FF0000;">
            <i class="fab fa-youtube"></i>
            </a>
      <button id="theme-toggle" aria-label="Toggle dark mode">🌙/☀️</button>
  </div>
  </div>
</header>
<div class="page-body">
  <aside class="sidebar">
  <button class="sidebar-close" id="sidebar-close" aria-label="Close sidebar">✕</button>
    <h2>Overview</h2>
<input type="text" id="search-input" placeholder="Search documents..." />
    <ul id="doc-list"></ul>
    <hr class="mobile-sidebar-divider mobile-only" />
<div class="mobile-sidebar-nav mobile-only">
  <a href="https://mhcpcreators.github.io/worlds-documentation/docs.html#docs%2Fmanuals-and-cheat-sheets%2Fget-started.md">Creator Docs</a>
  <a href="https://developers.meta.com/horizon-worlds/learn">Meta Docs</a>
  <a href="https://github.com/MHCPCreators/horizonCreatorManual">Creator Manual</a>
  <a href="https://communityforums.atmeta.com/t5/Creator-Forum/ct-p/Meta_Horizon_Creator_Forums">Forums</a>
  <a href="https://mhcpcreators.github.io/worlds-documentation/docs.html#docs%2Fmanuals-and-cheat-sheets%2Fcontribute-to-creator-documentation.md">Contribute</a>
</div>

  </aside>

  <main class="content">
    <div class="doc-container">
      <div id="doc-content"> <h1 id="json-ppvs-and-versioning">JSON PPVS and versioning</h1>
<p>Author: Laex05</p>

<h2 id="introduction">Introduction</h2>

<h4 id="creator-skill-level">Creator Skill Level</h4>
<p>Intermediate</p>

<h4 id="recommended-prerequisite-background-knowledge">Recommended Prerequisite Background Knowledge</h4>

<p>Some TypeScript experience is recommended as well as access to the desktop editor, and VS Code.</p>

<h4 id="description">Description</h4>

<p>Learn how to create, store, and manage JSON Objects as Player Persistent Variables (PPVs) in Meta Horizon, including versioning for updates and expansions. Given Meta Horizon’s 10kb data limit for PPVs, we’ll show you how to evaluate and optimize your JSON Object’s size.</p>

<p>This knowledge enables the storage of hundreds of variables in a single JSON PPV, facilitating the creation of experiences that remember visitor progress and allow seamless continuation. Additionally, it supports the growth of player data in future updates without the need for new JSON PPVs.</p>

<h4 id="learning-objectives">Learning Objectives</h4>

<p>By reading and reviewing this written guide you will be able to:</p>

<ul>
  <li>Create and store JSON Objects as Player Persistent Variables</li>
  <li>Add versioning to JSON PPVs: allows for updating and adding new variables</li>
  <li>Check the variable’s max size</li>
</ul>

<h2 id="step-1-create-a-json-ppv">Step 1: Create a JSON PPV</h2>

<p>Once the world is loaded, click the systems drop-down and select “Persistent Variables.”</p>

<p><img src="images/Screenshot%202024-03-12%20165250.png" alt="Screenshot 2024-03-12 165250.png" /></p>

<p>Click the plus icon to create a variable.</p>

<p>In this example, we will name it “TestVar” making sure to select “{ } Object” from the drop-down.</p>

<p><img src="images/Screenshot%202024-03-12%20165344.png" alt="Screenshot 2024-03-12 165344.png" /></p>

<p>Now that JSON Object PPV has been created, it can be used in TypeScript scripts by referencing it using the string name it was given: “TestVar.”</p>

<h2 id="step-2-create-scripts">Step 2: Create Scripts</h2>

<p>To begin, we will create two scripts with the specified names seen below. It’s important to verify that Meta Horizon’s 2.0 API is selected by accessing the settings via the gear icon. <img src="images/Screenshot%202024-03-12%20165632.png" alt="Screenshot 2024-03-12 165632.png" /></p>

<h3 id="specified-script-names">Specified Script Names:</h3>

<ul>
  <li>PlayerVar_Defs</li>
  <li>PlayerVar_Manager</li>
</ul>

<h3 id="mentors-note">Mentor’s Note</h3>

<p>Defs and _Manager are two of several naming conventions I use in my scripts to help organize and plan my code. There are no right or wrong approaches, so feel free to adopt one that works well for you.</p>

<p>_Defs store type declarations, classes, and enums.</p>

<p>_Manager handles logic and typically has a Component that attaches to a single object in the world.</p>

<p>Other naming conventions I use include, _Data, _Entity, and _Func.</p>

<h3 id="script-setup">Script Setup</h3>

<p>As of the current Meta Horizon desktop build (March 2024), creating a new world requires the initial creation of a 1.0 script prior to switching the script mode to 2.0. Once the switch is made, the 1.0 script can be deleted.</p>

<p>Access to this feature is found under the script tab: select the gear icon, followed by Script Settings to view the API Version drop-down:</p>

<p><img src="images/Screenshot%202024-03-19%20152547.png" alt="" /></p>

<h2 id="step-3-prepare-scripts">Step 3: Prepare Scripts</h2>

<p>To get started delete all the prefilled code from the _Defs file, and adjust the _Manager to explicitly import Component, rather than * as “hz” importing all.</p>

<p>Note: This is a personal preference, please choose the approach that works best for you.</p>

<h3 id="mentors-note-1">Mentor’s Note</h3>

<p>I personally like the explicit approach as you will know all items that have been imported from specific APIs, and you can do less typing, which is always nice!</p>

<p><img src="images/Screenshot%202024-03-12%20165657.png" alt="" /></p>

<p><img src="images/Screenshot%202024-03-12%20165809.png" alt="" /></p>

<h2 id="what-are-json-objects">What Are JSON Objects?</h2>

<p>JSON objects are powerful variables that can store various types of data. JSON objects can even nest inside of each other. These may be referred to simply as objects, variable folders, or more informally “bags of stuff.”</p>

<p>This is a simple example storing just two variables for tracking a player’s name and number of visits:</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">playerInfo</span> <span class="o">=</span> <span class="p">{</span> <span class="na">name</span><span class="p">:</span> <span class="err">‘</span><span class="nx">playerName</span><span class="err">’</span><span class="p">,</span> <span class="na">visits</span><span class="p">:</span> <span class="mi">0</span> <span class="p">};</span>
</code></pre></div></div>

<p>In TypeScript it is often necessary to define a type to describe the object, for instance, in this case we would have:</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">type</span> <span class="nx">PlayerInfo</span> <span class="o">=</span> <span class="p">{</span><span class="na">name</span><span class="p">:</span> <span class="kr">string</span><span class="p">;</span> <span class="nl">visits</span><span class="p">:</span> <span class="kr">number</span><span class="p">};</span>
</code></pre></div></div>

<p>We then need to declare the Type when creating the playerInfo variable:</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">playerInfo</span><span class="p">:</span> <span class="nx">PlayerInfo</span> <span class="o">=</span> <span class="p">{</span> <span class="na">name</span><span class="p">:</span> <span class="err">‘</span><span class="nx">playerName</span><span class="err">’</span><span class="p">,</span> <span class="na">visits</span><span class="p">:</span> <span class="mi">0</span> <span class="p">};</span>
</code></pre></div></div>

<p>Notice that the variable is in camelCase and the type is in PascalCase. This differentiation shows that the playerInfo is the object variable storing the data. And, PlayerInfo is the type we are declaring it to be.</p>

<p>Next let’s look at a complex example, with nested objects and multiple variable types. In this example, notice that when the type is larger the variable is broken onto its own line:</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">type</span> <span class="nx">PlayerInfo</span> <span class="o">=</span> <span class="p">{</span>
<span class="na">name</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span>
<span class="na">visits</span><span class="p">:</span> <span class="nx">PlayerVisits</span><span class="p">,</span>
<span class="na">scores</span><span class="p">:</span> <span class="nx">PlayerScores</span><span class="p">,</span>
<span class="p">};</span>

<span class="kd">type</span> <span class="nx">PlayerVisits</span> <span class="o">=</span> <span class="p">{</span>
<span class="na">totalVisits</span><span class="p">:</span> <span class="kr">number</span><span class="p">,</span>
<span class="na">uniqueDays</span><span class="p">:</span> <span class="kr">number</span><span class="p">,</span>
<span class="na">totalTimeMins</span><span class="p">:</span> <span class="kr">number</span><span class="p">,</span>
<span class="na">lastVisitTimeSinceEpochMs</span><span class="p">:</span> <span class="kr">number</span><span class="p">,</span>
<span class="p">};</span>

<span class="kd">type</span> <span class="nx">PlayerScores</span> <span class="o">=</span> <span class="p">{</span>
<span class="na">fastestTime</span><span class="p">:</span> <span class="kr">number</span><span class="p">,</span>
<span class="na">highScore</span><span class="p">:</span> <span class="kr">number</span><span class="p">,</span>
<span class="p">};</span>

<span class="kd">const</span> <span class="nx">playerInfo</span><span class="p">:</span> <span class="nx">PlayerInfo</span> <span class="o">=</span> <span class="p">{</span>
<span class="na">name</span><span class="p">:</span> <span class="err">‘</span><span class="nx">playerName</span><span class="err">’</span><span class="p">,</span>
<span class="na">visits</span><span class="p">:</span> <span class="p">{</span>
<span class="na">totalVisits</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<span class="na">uniqueDays</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<span class="na">totalTimeMins</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<span class="na">lastVisitTimeSinceEpochMs</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<span class="p">},</span>

<span class="na">scores</span><span class="p">:</span> <span class="p">{</span>
<span class="na">fastestTime</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<span class="na">highScore</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<span class="p">},</span>
<span class="p">};</span>
</code></pre></div></div>

<h2 id="step-4-connect-events">Step 4: Connect Events</h2>

<p>Next, we will connect the CodeBlockEvents for player enter and exit world to local methods. We have also added a console log to the methods to confirm the script is working.</p>

<p><img src="images/Screenshot%202024-03-12%20171631.png" alt="Screenshot 2024-03-12 171631.png" /></p>

<p>Ensure that the PlayerVar_Manager script is attached to an object in your world. In this example, I used a text object:</p>

<p><img src="images/Screenshot%202024-03-12%20171735.png" alt="Screenshot 2024-03-12 171735.png" />
<img src="images/Screenshot%202024-03-12%20171909.png" alt="Screenshot 2024-03-12 171909.png" />
<img src="images/Screenshot%202024-03-12%20171909.png" alt="Screenshot 2024-03-12 171909.png" /></p>

<h2 id="step-5-define-type">Step 5: Define Type</h2>

<p>Before we can get and set a JSON Object PPV, we need to define it. Because this type is stored in a _Defs script, we need to be able to access it from our other script files. To do this we add the word export to the front.</p>

<p><img src="images/Screenshot%202024-03-12%20181652.png" alt="Screenshot 2024-03-12 181652.png" /></p>

<p>Now that we have exported the type, we can import it into any of our other scripts by typing “PlayerVar” and clicking “enter” or “return” on our keyboard to import the type.</p>

<h2 id="step-6-map-playervar">Step 6: Map PlayerVar</h2>

<p>Now that our _Defs file is setup, we need a place to store all of our player variable data. We will do this in a _Data script.</p>

<p>Create a new script in Meta Horizon named “PlayerVar_Data,” and then we will delete all of the prefilled code as we did with the _Defs script.</p>

<p><img src="/docs/getting-started-with-scripting/images/Screenshot%202024-03-12%20181658.png" alt="Screenshot 2024-03-12 181658.png" /></p>

<p>We will only need to write one line of code, and as we do, VS Code will write the import lines seen in the screenshot on lines 1 and 2.</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kd">const</span> <span class="nx">allPlayerVarData</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Map</span><span class="o">&lt;</span><span class="nx">Player</span><span class="p">,</span> <span class="nx">PlayerVar</span><span class="o">&gt;</span><span class="p">();</span>
</code></pre></div></div>

<p><strong>Note:</strong> You will need to press enter after typing “Player” and “PlayerVar” for these two types to be imported. If your IDE, in this case VS Code, doesn’t support automatic importing you may need to write lines 1 and 2.</p>

<h2 id="what-is-a-map">What is a Map?</h2>

<p>A map is a data type that is similar to a list, but does not use indexes. Instead you can have one of the first type (the key), with the second type “mapped” to that key.</p>

<p>In this example (seen in the image above) we have a player as our key. Because a player cannot be in the world twice, only unique players can exist in our world, it makes for a perfect key. Then the data we are mapping to that player is the PlayerVar type we defined in the _Defs file.</p>

<p>Exporting this map as a constant prevents overwriting it with a new map. Instead, modifications must be made using the map’s set and delete methods, which will be discussed later in this document.</p>

<p>We also export this data, because it is very likely you will need to use it across multiple scripts. Since we will not be setting the PPV until the player leaves the world, this means that the map will store the player’s JSON Object PPV for the duration of their stay. In other words it is the source of truth for the most up-to-date variable values.</p>

<h2 id="step-7-playervar_manager">Step 7: PlayerVar_Manager</h2>

<p>In this step, we will start to write some code.  On the next few pages, we will provide in-depth explanations for each line:</p>

<p><img src="images/Screenshot%202024-03-12%20181721.png" alt="" /></p>

<p>At the beginning of the script, you’ll encounter the variables. These variables are globally scoped variables, which means they are accessible from anywhere inside this script. These variables are constants; for instance, the playerVariableVersion should only be updated manually when introducing new variables—a process detailed later in the document (Step 9). Similarly, the playerVarName remains unchanged as it serves as a reference to the PPV variable.</p>

<p><img src="images/Screenshot%202024-03-12%20181721.png" alt="Screenshot 2024-03-12 181721.png" /></p>

<p>In playerEnterWorld we first get the PPV. Notice that it could be null, we handle this in the initializePlayerVar method (seen at the end of this step). Which we use to create a newPlayerVar. We have to create a newPlayerVar because the player may have last played in an older version with less variables stored in the PlayerVar type.</p>

<p><img src="images/Screenshot%202024-03-12%20181721.png" alt="Screenshot 2024-03-12 181721.png" /></p>

<p>Then we update the visits to be visits + 1, using the shorthand visits++. To make sure this is working we add a console log.</p>

<p>The last step is to add the player to the map we created in the previous step. We do this by using the .set method, which will replace the previous value if it has already been set. You can use the .has method, if you want to see if the player has already been mapped.</p>

<p>In playerExitWorld we get the playerVar from the map, which if you hover over the const playerVar will show that it is of type PlayerVar or Undefined. This is because it is possible that a player has not yet been mapped. We can check for this with if (playerVar) which checks if it is “true,” meaning not <em>undefined</em> , <em>null</em> , <em>false</em> or sort of false (i.e., 0, empty string). We can use an else statement that calls on console log if it is undefined; this can help locate bugs now and in the future. It is recommended to use checks like this in your code.</p>

<p><img src="images/Screenshot%202024-03-12%20181721.png" alt="Screenshot 2024-03-12 181721.png" /></p>

<p>Now that we know playerVar is defined, we can set the player’s JSON Object PPV, which saves their JSON Object to the world’s persistent storage.</p>

<p>At the very end, we delete the player from the map.</p>

<p>Outside of our PlayerVar_Manager class, we can create functions. Note that these are similar to methods, but methods are stored inside classes. In this case, we are creating a function called initializePlayerVar, which will return a PlayerVar.</p>

<p>This function is important because it allows us to take a potentially null/undefined value, or partially defined value, and create a new object variable.</p>

<p><strong>Please note</strong>: There is an error as of the time of writing in Meta Horizon’s API, which says the variable could be defined or null, but is actually defined or undefined. This distinction caused an error with the code seen at the beginning of this step, <strong>below the code is corrected, checking the truthiness of (prevPlayerVar) rather than (prevPlayerVar !== null).</strong></p>

<p><img src="/docs/getting-started-with-scripting/images/initializeplayervar.png" alt="" /></p>

<p>The first thing we do in this function is create a brand new object variable with values we would assign to a first-time visitor. That way if the prevPlayerVar is not truthy we return those values. Otherwise, we can check that the version contains values we want to recall, and save them to the new object.</p>

<p>Now you can compile your newly saved code and test it. If all goes well, every time you preview the world, your number of visits will go up by one, and log to the console!</p>

<h2 id="step-8-test-playervar-size">Step 8: Test PlayerVar Size</h2>

<p>Now that we have our JSON Object PPV, we need to make sure we don’t run it over the 10,000 character limit. To test this we can create an artificial maxed variable and stringify it to see how long it is.</p>

<p><img src="images/Screenshot%202024-03-12%20184022.png" alt="Screenshot 2024-03-12 184022.png" /></p>

<p>In our testPlayerVarSize function, we have created a testPlayerVar variable with larger-than-possible values. We then calculate the length using JSON.stringify, and the .length property of strings. We then simply log that number to the console.</p>

<p>All that is left, is to call this in the start method. When we are done, we can delete this line of code from start, and write it in anytime we need to check the max length.</p>

<p><img src="images/Screenshot%202024-03-12%20184035.png" alt="Screenshot 2024-03-12 184035.png" /></p>

<h2 id="step-9-add-more-variables">Step 9: Add More Variables</h2>

<p>Start by updating the type to include additional variables. In this case we added isAFK and afkCount:</p>

<p><img src="images/Screenshot 2024-03-19 at 12.18.46 PM.png" alt="Screenshot 2024-03-19 at 12.18.46 PM.png" /></p>

<p>We then add these to the initialize and test size functions:</p>

<p><img src="images/Screenshot%202024-03-12%20185301.png" alt="Screenshot 2024-03-12 185301.png" />
<img src="images/Screenshot%202024-03-12%20185200.png" alt="Screenshot 2024-03-12 185200.png" /></p>

<p>We also need to update the version number from 1 to 2:
<img src="images/Screenshot%202024-03-12%20185053.png" alt="Screenshot 2024-03-12 185053.png" /></p>

<p>Then we can use this new version number to get the afkCount for players who have visited our world since the variable was added:</p>

<p><img src="images/Screenshot%202024-03-12-185249.png" alt="Screenshot 2024-03-12 185249.png" /></p>

<h2 id="step-10-use-the-variables">Step 10: Use the Variables</h2>

<p>To get started using our new afkCount variable, we will connect the CodeBlockEvents for entering AFK to our local method:</p>

<p><img src="images/Screenshot%202024-03-12%20185526.png" alt="Screenshot 2024-03-12 185526.png" /></p>

<p><img src="images/Screenshot%202024-03-12%20185514.png" alt="Screenshot 2024-03-12 185514.png" /></p>

<p>Then we can get the playerVar and check the truthiness, updating the count to be +1. For extra credit try adding the playerExitAFK method and updating the boolean we added to the playerVar. Setting it to true when AFK, and false when they return from AFK.</p>

<h3 id="mentors-note-2">Mentor’s Note</h3>

<p>When a player arrives to your world, I have experienced in build mode this causing the AFK events to fire before the player enter world event does, so you will need to make sure the map has the player before setting the value, or check the truthiness as we did above.</p>

<h2 id="further-assistance">Further Assistance</h2>

<p>Thank you for following along! This guide aims to unlock your TypeScript super powers, and add awesome new features to your worlds!</p>

<p>Consider trying the extra credit tasks below to solidify your learning and take it to the next level!</p>

<h2 id="next-steps">Next Steps</h2>

<p>Below we have provided some challenges for you to try implementing on your own. These do require some outside knowledge, and we encourage you to ask questions in the <a href="https://communityforums.atmeta.com/t5/Creator-Forum/ct-p/Meta_Horizon_Creator_Forums">community forums</a> if you get stuck or are unsure how to complete these</p>

<h3 id="novice">Novice</h3>

<p>Track player visits and time spent in your world.</p>

<h3 id="intermediate">Intermediate</h3>

<p>Track unique daily visits a player has had to your world.</p>

<h3 id="advanced">Advanced</h3>

<p>Build a streak system to track how many days in a row each player has visited your world.</p>

<h3 id="bonus">Bonus</h3>

<p>Give the player a reward for visiting your world once per day, and or when they reach time spent thresholds.</p>
</div>
      <div class="nav-buttons">
        <button id="prev-btn">← Previous</button>
        <button id="next-btn">Next →</button>
      </div>
    </div>
  </main>

  <aside class="right-sidebar">
    <h3>On this page</h3>
    <ul id="doc-toc"></ul>
  </aside>
  </div>

  <!-- Footer -->
  <footer class="site-footer">
  <div class="footer-links">
    <p>Built by MHCP Creators • 
      <a href="https://github.com/MHCPCreators/worlds-documentation">GitHub</a> • 
      <a href="https://communityforums.atmeta.com/t5/Creator-Forum/ct-p/Meta_Horizon_Creator_Forums">Forums</a> •
    </p>
    <a href="https://www.youtube.com/@metahorizoncreatorprogram" target="_blank" aria-label="Creator Programs YouTube Channel">
      <i class="fab fa-youtube"></i>
    </a>
  </div>
  </footer>

<script src="/assets/js/docs-script.js?v=4633a66e9b4499c8614a483d910c8b4277e9467a"></script>

</body>
</html>
